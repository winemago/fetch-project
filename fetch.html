<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fetch()</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
<body>
    <img id="img" src="">

    <h1>Surface Temperature Analysis</h1>
    <canvas id="chart" width="200" height="100"></canvas>
    <p>According to an ongoing temperature analysis conducted by scientists at NASA’s Goddard Institute for Space Studies (GISS), the average global temperature on Earth has increased by a little more than 1° Celsius (2° Fahrenheit) since 1880. Two-thirds of the warming has occurred since 1975, at a rate of roughly 0.15-0.20°C per decade.</p>
    <p>The graph above show absolute temperature. They depict how much various regions of the world have warmed or cooled when compared with a base period of 1951-1980. (The global mean surface air temperature for that period was estimated to be 14°C (57°F)</p>
    <p><a href="https://data.giss.nasa.gov/gistemp/ "> Data from </a></p>
    <p><a href="https://earthobservatory.nasa.gov/world-of-change/DecadalTemp">Mean from </a></p>  

    <h1>ISS live</h1>
    <p>latitud: <span id="lat"></span></p>
    <p>longitud: <span id="lon"></span></p>
    <p>velocidad: <span id="vel"></span> Km/h</p>

    <h1>Astronomy Picture of the Day.</h1>
    <img src="" alt="apod" id="apod_img">
    <h2 id="title"></h2>
    <p>By <span id="copyr"></span> - <span id="date"> </span></p>
    <p id="explanation"></p>
    
    
    <script>

      window.addEventListener('load', chartIT);
        getBlob();
        getCsv();
        getSAT();
        getApod();

        function getBlob(){    //using .then
            fetch('v0oY4ZLt.jpg')
            .then(response =>{                                   
                return response.blob();
            }).then(image =>{
                document.getElementById('img').src=URL.createObjectURL(image);
            });
        }

        async function getCsv(){   //using async/await
            // Data from: https://data.giss.nasa.gov/gistem  
            // Mean from: https://earthobservatory.nasa.gov/world-of-change/DecadalTemp                                 
            const response = await fetch('ZonAnn.Ts+dSST.csv');                      
            const data = await response.text();

            const year=[];
            const globalTemp=[];
            const northTemp=[];
            const southTemp=[];

            const columns = data.split('\n').slice(1);
            //console.log(columns);
            for(let i=0; i<columns.length; i++){
                const rows=columns[i].split(',');
                year.push(rows[0]);
                globalTemp.push(parseFloat(rows[1]) + 14 );                 //add 14, couse The global mean surface air temperature for that period was estimated to be 14°C
                northTemp.push(parseFloat(rows[2]) + 14 );
                southTemp.push(parseFloat(rows[3]) + 14 );

                console.log(rows[0],rows[1],rows[2],rows[3]);
            }
            return{year,globalTemp,northTemp,southTemp};
        }      

        async function chartIT(){
            const ctx = document.getElementById('chart').getContext('2d');
            const datatemps = await getCsv();
            console.log(datatemps);
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: datatemps.year,
                    datasets: [
                    {
                        label: 'GLOBAL AVERAGE TEMPERATURE',
                        data: datatemps.globalTemp,
                        borderWidth: 1,
                        backgroundColor:'rgba(232, 123, 114, 11)',
                        borderColor:'rgba(232,223,114,11)',
                        hoverBorderColor: 'rgba(132, 23, 114, 11)',
                        fill: false
                    },
                    {
                        label: 'GLOBAL AVERAGE IN NORTH HEMISPHERE',
                        data: datatemps.northTemp,
                        borderWidth: 1,
                        backgroundColor:'rgba(132, 223, 114, 11)',
                        borderColor:'rgba(232,223,114,11)',
                        hoverBorderColor: 'rgba(132, 23, 114, 11)',
                        fill: false
                    },
                    {
                        label: 'GLOBAL AVERAGE IN SOUTH HEMISPHERE',
                        data: datatemps.southTemp,
                        borderWidth: 1,
                        backgroundColor:'rgba(032, 123, 214, 11)',
                        borderColor:'rgba(232,223,114,11)',
                        hoverBorderColor: 'rgba(132, 23, 114, 11)',
                        fill: false
                    }
                ]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                ///beginAtZero: true,
                                callback: function(value, index, values) {
                                    return value + '°';
                                }

                            }
                        }]
                    }
                }
            });
        }

        async function getSAT(){
            const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
            const data = await response.json();
            console.log(data);

            document.getElementById('lat').textContent = data.latitude;
            document.getElementById('lon').textContent = data.longitude;
            document.getElementById('vel').textContent = data.velocity;
        }

        async function getApod(){

            const response = await fetch('https://api.nasa.gov/planetary/apod?api_key=0cymwPxbsjzfDJuYPaSucWz3gyY9Ra6Sq9bxITCe');
            const data = await response.json();

            document.getElementById('apod_img').src=data.url;
            document.getElementById('title').textContent = data.title;
            document.getElementById('copyr').textContent = data.copyright;
            document.getElementById('date').textContent = data.date;
            document.getElementById('explanation').textContent = data.explanation;
        }             
    </script>
</body>
</html>
